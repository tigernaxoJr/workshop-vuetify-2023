import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.15f172dd.js";const o="/sso.png",d=JSON.parse('{"title":"身分驗證","description":"","frontmatter":{},"headers":[],"relativePath":"workshop/project/template/auth.md","filePath":"workshop/project/template/auth.md"}'),p={name:"workshop/project/template/auth.md"},e=l('<h1 id="身分驗證" tabindex="-1">身分驗證 <a class="header-anchor" href="#身分驗證" aria-label="Permalink to &quot;身分驗證&quot;">​</a></h1><h2 id="sso" tabindex="-1">SSO <a class="header-anchor" href="#sso" aria-label="Permalink to &quot;SSO&quot;">​</a></h2><p>在典型的單一登入模型中，前端的路由設置常使用 History 模式，這是為了避免重新導向時的問題。如果使用 Hash 模式，當重新導向發生時，重新導向後的路由資訊可能會丟失。而使用 History 模式則可以更好地處理重新導向，確保路由資訊的完整性。</p><p><img src="'+o+`" alt=""></p><p>或直接參考 <a href="https://datatracker.ietf.org/doc/html/rfc6749#section-4.1" target="_blank" rel="noreferrer">rfc6749</a></p><p>P.S. 單頁應用程式 (SPA) 通常使用 Code Flow 進行身份驗證。&quot;Code Flow&quot; 是單一登入 (Single Sign-On, SSO) 中的一種授權流程，在這個流程中，前端程式接收表示密鑰的 Code，接著與 OpenID Connect (OIDC) 伺服器交換以獲取 Token。此 Token 作為憑證，用於對 API 發起請求。</p><h2 id="缺少身份驗證伺服器的解決方案" tabindex="-1">缺少身份驗證伺服器的解決方案 <a class="header-anchor" href="#缺少身份驗證伺服器的解決方案" aria-label="Permalink to &quot;缺少身份驗證伺服器的解決方案&quot;">​</a></h2><p>目前情況摘要：</p><ol><li>目前尚未建立身份驗證伺服器。</li><li>登入的規範要求接收一種名為「KEY」的值，類似於代碼（code）的內容。</li></ol><p>目前可採取的解決策略：</p><ol><li>建立一個專門為「KEY」而設的登入入口，以免每個前端應用都需自行實現登入頁面和 KEY 請求的邏輯。</li><li>建立一個簡易交換 token 的 api。</li></ol><h2 id="登入實做" tabindex="-1">登入實做 <a class="header-anchor" href="#登入實做" aria-label="Permalink to &quot;登入實做&quot;">​</a></h2><p>以 <code>src/store/auth.js</code> 為例</p><h2 id="登出策略" tabindex="-1">登出策略 <a class="header-anchor" href="#登出策略" aria-label="Permalink to &quot;登出策略&quot;">​</a></h2><table><thead><tr><th>登出類型</th><th>方法</th></tr></thead><tbody><tr><td>一般登出</td><td>移除 token 並回到登入頁(登入頁面或外部網站)。</td></tr><tr><td>光田人登出</td><td>直接回到光田人網址。</td></tr></tbody></table><h2 id="登出組件" tabindex="-1">登出組件 <a class="header-anchor" href="#登出組件" aria-label="Permalink to &quot;登出組件&quot;">​</a></h2><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">v-icon</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">v-bind</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;{ ...$attrs, onClick, icon }&quot;</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">v-icon</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setup</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">lang</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;ts&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">emit</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">defineEmits</span><span style="color:#E1E4E8;">([</span><span style="color:#9ECBFF;">&#39;click&#39;</span><span style="color:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//#region 裝置判斷</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">TABLET_PATTERN</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">(tablet</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">ipad</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">playbook</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">silk)</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">(android(?!</span><span style="color:#79B8FF;">.</span><span style="color:#F97583;">*</span><span style="color:#DBEDFF;">mobi))</span><span style="color:#9ECBFF;">/</span><span style="color:#F97583;">i</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">MOBILE_PATTETN</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">Mobile</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">iP(hone</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">od)</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">Android</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">BlackBerry</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">IEMobile</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">Kindle</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">Silk-Accelerated</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">(hpw</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">web)OS</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">Opera M(obi</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">ini)</span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">const </span><span style="color:#B392F0;">getDevice</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">userAgent</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> navigator </span><span style="color:#6A737D;">// 取得使用者裝置</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">TABLET_PATTERN</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">test</span><span style="color:#E1E4E8;">(userAgent)) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;tablet&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 判斷平板</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">MOBILE_PATTETN</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">test</span><span style="color:#E1E4E8;">(userAgent)) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;mobile&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 判斷手機</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;desktop&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 都不是的話就是桌面</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">isDesktop</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getDevice</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;desktop&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 是否為桌機</span></span>
<span class="line"><span style="color:#6A737D;">//#endregion</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 決定 icon</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">icon</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> isDesktop </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;mdi-logout&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;mdi-home&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//#region 點擊動作</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">MEIP_URL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;https://m-eip.ktgh.com.tw/MEIP_ServerHttps/&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 光田人網址</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">goMeip</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> (window.location.href </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">MEIP_URL</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">// 回光田人</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">onClick</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">isDesktop </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> goMeip </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">emit</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;click&#39;</span><span style="color:#E1E4E8;">, e) </span><span style="color:#6A737D;">// 決定點擊動作</span></span>
<span class="line"><span style="color:#6A737D;">//#endregion</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">template</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">v-icon</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">v-bind</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;{ ...$attrs, onClick, icon }&quot;</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">v-icon</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">template</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">script</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setup</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">lang</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;ts&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">emit</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">defineEmits</span><span style="color:#24292E;">([</span><span style="color:#032F62;">&#39;click&#39;</span><span style="color:#24292E;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//#region 裝置判斷</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">TABLET_PATTERN</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/(tablet</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">ipad</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">playbook</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">silk)</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">(android(?!</span><span style="color:#005CC5;">.</span><span style="color:#D73A49;">*</span><span style="color:#032F62;">mobi))/</span><span style="color:#D73A49;">i</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">MOBILE_PATTETN</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">/Mobile</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">iP(hone</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">od)</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">Android</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">BlackBerry</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">IEMobile</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">Kindle</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">Silk-Accelerated</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">(hpw</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">web)OS</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">Opera M(obi</span><span style="color:#D73A49;">|</span><span style="color:#032F62;">ini)/</span></span>
<span class="line"><span style="color:#24292E;">const </span><span style="color:#6F42C1;">getDevice</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">userAgent</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> navigator </span><span style="color:#6A737D;">// 取得使用者裝置</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">TABLET_PATTERN</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">test</span><span style="color:#24292E;">(userAgent)) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;tablet&#39;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 判斷平板</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">MOBILE_PATTETN</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">test</span><span style="color:#24292E;">(userAgent)) </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;mobile&#39;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 判斷手機</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;desktop&#39;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 都不是的話就是桌面</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">isDesktop</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getDevice</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;desktop&#39;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 是否為桌機</span></span>
<span class="line"><span style="color:#6A737D;">//#endregion</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 決定 icon</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">icon</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> isDesktop </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;mdi-logout&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;mdi-home&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//#region 點擊動作</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">MEIP_URL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;https://m-eip.ktgh.com.tw/MEIP_ServerHttps/&#39;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 光田人網址</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">goMeip</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> (window.location.href </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">MEIP_URL</span><span style="color:#24292E;">) </span><span style="color:#6A737D;">// 回光田人</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">onClick</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">!</span><span style="color:#24292E;">isDesktop </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> goMeip </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#E36209;">e</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">emit</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;click&#39;</span><span style="color:#24292E;">, e) </span><span style="color:#6A737D;">// 決定點擊動作</span></span>
<span class="line"><span style="color:#6A737D;">//#endregion</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">script</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><h2 id="reference" tabindex="-1">Reference <a class="header-anchor" href="#reference" aria-label="Permalink to &quot;Reference&quot;">​</a></h2><ul><li><a href="https://datatracker.ietf.org/doc/html/rfc6749" target="_blank" rel="noreferrer">RFC6749 - The OAuth 2.0 Authorization Framework</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc6750" target="_blank" rel="noreferrer">RFC6750 - The OAuth 2.0 Authorization Framework: Bearer Token Usage</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc6819" target="_blank" rel="noreferrer">RFC6819 - OAuth 2.0 Threat Model and Security Considerations</a></li></ul>`,19),t=[e];function c(r,y,E,i,F,D){return n(),a("div",null,t)}const h=s(p,[["render",c]]);export{d as __pageData,h as default};
